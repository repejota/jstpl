(function(a){var b=new function(){this.TAG_START="{%";this.TAG_END="%}";this.VAR_START="{{";this.VAR_END="}}";this.VAR_TOKEN=0;this.TAG_TOKEN=1;this.TEXT_TOKEN=2;var d="(";d+=this.TAG_START.replace(/(\(|\)|\{|\})/g,"\\$1");d+=".*?";d+=this.TAG_END.replace(/(\(|\)|\{|\})/g,"\\$1");d+="|";d+=this.VAR_START.replace(/(\(|\)|\{|\})/g,"\\$1");d+=".*?";d+=this.VAR_END.replace(/(\(|\)|\{|\})/g,"\\$1");d+="|$)";console.debug(d);var c=new RegExp(d,"g");this.createToken=function(e){if(e.indexOf(b.TAG_START)===0){return new b.token(b.TAG_TOKEN,e.slice(b.TAG_START.length,-b.TAG_END.length))}else{if(e.indexOf(b.VAR_START)===0){return new b.token(b.VAR_TOKEN,e.slice(b.VAR_START.length,-b.VAR_END.length))}else{return new b.token(b.TEXT_TOKEN,e)}}};this.compile=function(e){var f=b.stringBuilder.bsplit(e,c);f=b.arrayBuilder.filter(f,"");var g=f.map(this.createToken);return new b.parser(g).parse()};this.render=function(g,f){var e=[];this.compile(g).map(function(h){if(typeof(h)=="object"){if(typeof(h.render)=="function"){e.push(h.render(f))}else{e.push(h.toString())}}else{e.push(h.toString())}});return e.join("")};this.getVar=function(f,e){e.split(".").map(function(g){f=f[g]});return f};this.listRender=function(e,f){return f.map(function(g){return g.render(e)}).join("")}};b.arrayBuilder={filter:function(c,d){var e=[];for(var f=0;f<c.length;f++){if(c[f]!=d){e.push(c[f])}}return e}};b.stringBuilder={bsplit:function(f,d){var e=0;var c=[];f.replace(d,function(h,g,i){c.push(f.slice(e,i));c.push(h);e=i+h.length});return c}};b.filter={};b.parser=function(c){this.tokens=c};b.parser.prototype={parse:function(c){if(!c){c=[]}if(!(c instanceof Array)){c=[c]}var e=[];var d=null;var g=null;var f=null;while(this.tokens.length){var d=this.tokens.shift();if(d.tokentype==b.TEXT_TOKEN){e.push(new b.TextNode(d.content))}else{if(d.tokentype==b.VAR_TOKEN){e.push(new b.VarNode(d.content))}else{if(d.tokentype==b.TAG_TOKEN){if(c.indexOf(d.content)!=-1){this.prependToken(d);return e}g="_"+d.content.split(/\s+/)[0];if(!g){throw (new Error("Empty Tag "+g))}f=b.tag[g];if(!f){throw (new Error("Unknow Tag "+g))}e.push(f(this,d))}}}}return e},skipPast:function(d){while(this.tokens.length){var c=this.tokens.shift();if(c.tokentype==b.TAG_TOKEN&&c.content==d){return}}throw (new Error("Not Closed Tag"))},prependToken:function(c){this.tokens.unshift(c)},nextToken:function(){return this.tokens.shift()},deleteFirstToken:function(){this.tokens.shift();return true}};b.tag={_comment:function(d,c){d.skipPast("endcomment");return b.CommentNode},_if:function(j,d){var g=d.content.split(/\s+/);var i;var c;var f;g.shift();if(!g){throw (new Error("If node need at least one args"))}var h=g.join(" "),e=h.split(" or ");if(e.length===1){i=b.ifNode._and;e=h.split(" and ")}else{i=b.ifNode._or;if(h.indexOf(" and ")!=-1){throw (new Error('If node do not alow mix "and" & "or"'))}}c=j.parse(["else","endif"]);d=j.nextToken();if(d.content.indexOf("else")!=-1){f=j.parse("endif");j.deleteFirstToken()}else{f=[]}return new b.ifNode(i,e,c,f)},_for:function(i,d){var f=d.content.split(/\s+/);if(f.length==5&&f[4]!=="reversed"){throw (new Error("The 4 arg of for tag must be reversed"))}if((f.length<4)||(f.length>5)){throw (new Error("The for tag should have 4 or 5 args"))}if(f[2]!=="in"){throw (new Error('The 2nd arg of for tag must be "in"'))}var c=f[1];var h=f[3];var g=(f.length===5);var e=i.parse("endfor");i.deleteFirstToken();return new b.forNode(c,h,g,e)}};b.token=function(c,d){this.tokentype=c;this.content=d};b.TextNode=function(c){this.text=c};b.TextNode.prototype={render:function(c){return this.text}};b.VarNode=function(c){this.name=c};b.VarNode.prototype={render:function(c){return b.getVar(c,this.name)}};b.CommentNode={render:function(){return""}};b.ifNode=function(f,e,c,d){this.link_type=f;this.boolpairs=e;this.nodelist_true=c;this.nodelist_false=d};b.ifNode._and=0;b.ifNode._or=0;b.ifNode.prototype={render:function(d){var c;if(this.link_type==b.ifNode._and){c=true;if(this.mapBoolPair(false,d)){c=false}}else{c=false;if(this.mapBoolPair(true,d)){c=true}}if(c){return b.listRender(d,this.nodelist_true)}else{return b.listRender(d,this.nodelist_false)}},mapBoolPair:function(c,f){for(var e=0;e<this.boolpairs.length;e++){var d=this.boolpairs[e].split(" ");if(d.length==2&&d[0]=="not"){if(c!=!!b.getVar(f,d[1])){return true}}else{if(c==!!b.getVar(f,d[0])){return true}}}return false}};b.forNode=function(c,f,e,d){this.loopvar=c;this.sequence=f.split(".");this.reversed=e;this.nodelist_loop=d};b.forNode.prototype={render:function(g){var c=[];var h;var e=g;if(g.forloop){h=g.forloop}for(var d=0;d<this.sequence.length;d++){e=e[this.sequence[d]]}if(!(e instanceof Array)){throw new Error("values is not a array")}if(this.reversed){e=e.reverse()}for(var f=0;f<e.length;f++){g.forloop={counter0:f,counter:f+1,revcounter:e.length-f,revcounter0:e.length-f-1,first:(f==0),last:(f==e.length-1),parentloop:h};g[this.loopvar]=e[f];c.push(b.listRender(g,this.nodelist_loop))}g.forloop=undefined;return c.join("")}};a.jstpl=b})(window);